
/**
 * 由 One-step-admin 提供技术支持
 * https://hooray.gitee.io/one-step-admin/
 * Powered by One-step-admin
 * https://hooray.github.io/one-step-admin/
 */
    
import{_ as e}from"./index.d92f6c0c.js";import{r as t,w as i,S as n,o,k as a,_ as s,A as l,x as r,z as d,l as c,m as h,$ as u,C as g}from"./vendor.b0dde714.js";import{_ as f}from"./index.c2d6d7be.js";import"./index.091d1180.js";const p=["id","onMousedown","onMousemove","onMouseup","onMouseleave","onTouchstart","onTouchmove","onTouchend"],m={props:{image:{required:!1,type:[String],default:null},options:{required:!1,type:[Object],default:()=>null}},emits:["confirm"],setup(e,{expose:l,emit:r}){const d=e,c=t(`sign-canvas-${Math.random().toString(36).substr(2)}`),h=t(null);let u=null,g=null,f=1,m={isFullScreen:!1,isFullCover:!1,isDpr:!1,lastWriteSpeed:1,lastWriteWidth:2,lineCap:"round",lineJoin:"round",canvasWidth:600,canvasHeight:600,isShowBorder:!0,bgColor:"#fcc",borderWidth:1,borderColor:"#ff787f",writeWidth:5,maxWriteWidth:30,minWriteWidth:5,writeColor:"#101010",isSign:!1,imgType:"png"},v=null;function w(){const e=d.options;if(e)for(const t in e)m[t]=e[t];f="undefined"!=typeof window&&m.isDpr&&(window.devicePixelRatio||window.webkitDevicePixelRatio||window.mozDevicePixelRatio)||1,u=document.getElementById(c.value),g=u.getContext("2d"),u.style.background=m.bgColor,m.isFullScreen&&(m.canvasWidth=window.innerWidth||document.body.clientWidth,m.canvasHeight=window.innerHeight||document.body.clientHeight,m.isFullCover&&(u.style.position="fixed",u.style.top=0,u.style.left=0,u.style.margin=0,u.style.zIndex=20001)),u.height=m.canvasWidth,u.width=m.canvasHeight,u.width=m.canvasWidth*f,u.height=m.canvasHeight*f,u.style.width=`${m.canvasWidth}px`,u.style.height=`${m.canvasHeight}px`,m.emptyCanvas=u.toDataURL(`image/${m.imgType}`),x()}function W(e){m.isWrite=!0,m.lastWriteTime=(new Date).getTime(),m.lastPoint=e,g.beginPath(),g.strokeStyle=m.writeColor,g.lineCap=m.lineCap,g.lineJoin=m.lineJoin}function y(e){g.beginPath(),g.moveTo(m.lastPoint.x*f,m.lastPoint.y*f),g.lineTo(e.x*f,e.y*f),function(){const e=(new Date).getTime(),t=e-m.lastWriteTime;m.lastWriteTime=e;let i=m.minWriteWidth+(m.maxWriteWidth-m.minWriteWidth)*t/30;if(i<m.minWriteWidth?i=m.minWriteWidth:i>m.maxWriteWidth&&(i=m.maxWriteWidth),i=i.toFixed(2),m.isSign)g.lineWidth=m.writeWidth*f;else{const e=m.lastWriteWidth=m.lastWriteWidth/4*3+i/4;g.lineWidth=e*f}}(),g.stroke(),m.lastPoint=e,g.closePath()}function T(e){m.isWrite=!1,m.lastPoint=e,C()}function x(){g.save(),g.strokeStyle=m.writeColor,g.clearRect(0,0,u.width,u.height),g.beginPath(),g.lineWidth=m.borderWidth*f,g.strokeStyle=m.borderColor;let e=m.borderWidth/2*f;m.isShowBorder&&(g.moveTo(e,e),g.lineTo(u.width-e,e),g.lineTo(u.width-e,u.height-e),g.lineTo(e,u.height-e),g.closePath(),g.stroke()),m.isShowBorder&&!m.isSign&&(g.moveTo(0,0),g.lineTo(u.width,u.height),g.lineTo(u.width,u.height/2),g.lineTo(0,u.height/2),g.lineTo(0,u.height),g.lineTo(u.width,0),g.lineTo(u.width/2,0),g.lineTo(u.width/2,u.height),g.stroke()),r("confirm",null),g.restore()}function C(){const e=new Image;return e.src=u.toDataURL(`image/${m.imgType}`),r("confirm",e.src),e.src}function b(e){W({x:e.offsetX||e.clientX,y:e.offsetY||e.clientY})}function S(e){m.isWrite&&y({x:e.offsetX,y:e.offsetY})}function k(e){T({x:e.offsetX,y:e.offsetY})}function P(e){m.isWrite=!1,m.lastPoint={x:e.offsetX,y:e.offsetY}}function R(e){const t=e.targetTouches[0];W({x:t.clientX?t.clientX-Y().left:t.pageX-$(t.target,"left"),y:t.clientY?t.clientY-Y().top:t.pageY-$(t.target,"top")})}function D(e){const t=e.targetTouches[0],i=t.clientX?t.clientX-Y().left:t.pageX-$(t.target,"left"),n=t.clientY?t.clientY-Y().top:t.pageY-$(t.target,"top");m.isWrite&&y({x:i,y:n})}function X(e){const t=e.targetTouches,i=e.changedTouches,n=t&&t.length&&t[0]||i&&i.length&&i[0];T({x:n.clientX?n.clientX-Y().left:n.pageX-$(n.target,"left"),y:n.clientY?n.clientY-Y().top:n.pageY-$(n.target,"top")})}function Y(){return h.value.getBoundingClientRect()}function $(e,t){const i="offset"+t[0].toUpperCase()+t.substring(1);let n=e[i],o=e.offsetParent;for(;null!=o;)n+=o[i],o=o.offsetParent;return n}return i((()=>d.options),(()=>w()),{deep:!0}),n((()=>{w(),window.addEventListener("resize",(()=>{v&&clearTimeout(v),v=setTimeout((()=>{w()}),100)}))})),l({canvasClear:x,saveAsImg:C,downloadSignImg:function(e){!function(e,t){const i=document.createElementNS("http://www.w3.org/1999/xhtml","a");i.href=e,i.download=t;const n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),i.dispatchEvent(n)}(document.getElementById(c.value).toDataURL("image/png"),e?`${e}.${m.imgType}`:`${Date.parse(new Date)}.${m.imgType}`)},dealImage:function(){var e=document.createElement("canvas"),t=e.getContext("2d");e.width=300,e.width=200;const i=document.getElementById(c.value).toDataURL("image/png");t.clearRect(0,0,e.width,e.height),t.drawImage(i,0,0,e.width,e.height),e.toDataURL("image/jpeg",.6)}}),(e,t)=>(o(),a("canvas",{id:c.value,ref:h.value,class:"app-sign-canvas",onMousedown:s(b,["prevent","stop"]),onMousemove:s(S,["prevent","stop"]),onMouseup:s(k,["prevent","stop"]),onMouseleave:s(P,["prevent","stop"]),onTouchstart:s(R,["prevent","stop"]),onTouchmove:s(D,["prevent","stop"]),onTouchend:s(X,["prevent","stop"])}," 您的浏览器不支持canvas技术,请升级浏览器! ",40,p))}},v=c("p",null,"SignCanvas 三方组件",-1),w=c("p",{style:{"margin-bottom":"0"}},"该组件可用于电子合同签订等在线签名使用场景",-1),W=u("组件仓库地址"),y=u("清除画板"),T=u("生成图片"),x=u("下载图片"),C=["src","width","height"],b={setup(i){const{proxy:n}=g(),s=t(""),u=t({isDpr:!0,lastWriteSpeed:1,lastWriteWidth:2,lineCap:"round",lineJoin:"bevel",canvasWidth:500,canvasHeight:250,isShowBorder:!1,bgColor:"#fee",borderWidth:1,borderColor:"#ff787f",writeWidth:5,maxWriteWidth:30,minWriteWidth:5,writeColor:"#101010",isSign:!0,imgType:"png"});function p(){n.$refs.signCanvasRef.canvasClear()}function b(){s.value=n.$refs.signCanvasRef.saveAsImg()}function S(){n.$refs.signCanvasRef.downloadSignImg()}return(t,i)=>{const n=d("el-button"),g=f,k=m,P=e;return o(),a("div",null,[l(g,{title:"电子签名"},{content:r((()=>[v,w])),default:r((()=>[l(n,{icon:"el-icon-link",onClick:i[0]||(i[0]=e=>{return t="https://github.com/langyuxiansheng/vue-sign-canvas",void window.open(t,"top");var t})},{default:r((()=>[W])),_:1})])),_:1}),l(P,null,{default:r((()=>[l(k,{ref:"signCanvasRef",options:u.value},null,8,["options"]),c("div",null,[l(n,{onClick:p},{default:r((()=>[y])),_:1}),l(n,{onClick:b},{default:r((()=>[T])),_:1}),l(n,{onClick:S},{default:r((()=>[x])),_:1})]),s.value?(o(),a("img",{key:0,src:s.value,width:u.value.canvasWidth,height:u.value.canvasHeight},null,8,C)):h("v-if",!0)])),_:1})])}}};export{b as default};
